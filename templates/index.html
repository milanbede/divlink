<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Terminal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="terminal">
        <div id="output">
            <div>Welcome to Bible Terminal!</div>
            <div>Type your query below and press Enter.</div>
            <div>&nbsp;</div>
        </div>
        <div class="prompt-line">
            <span class="prompt">&gt;</span>
            <input type="text" id="commandInput" autofocus>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const commandInput = document.getElementById('commandInput');
            const outputDiv = document.getElementById('output');

            commandInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const command = commandInput.value.trim();
                    if (command) {
                        // Display command in output
                        const commandElement = document.createElement('div');
                        commandElement.innerHTML = `<span class="prompt-echo">&gt;</span> ${escapeHtml(command)}`;
                        outputDiv.appendChild(commandElement);

                        // Call typeResponse for the placeholder functionality
                        const responseText = `Processing: "${escapeHtml(command)}" (LLM/DB integration pending)`;
                        typeResponse(responseText, outputDiv, () => {
                            // This callback runs after typing is complete
                            outputDiv.appendChild(document.createElement('br')); // Add line break after response
                            commandInput.value = ''; // Clear input
                            outputDiv.scrollTop = outputDiv.scrollHeight; // Scroll to bottom
                            commandInput.focus(); // Keep focus on input
                        });
                    } else {
                        // Handle empty command: echo an empty prompt and add a line break
                        const commandElement = document.createElement('div');
                        commandElement.innerHTML = `<span class="prompt-echo">&gt;</span>&nbsp;`; // Echo empty prompt with a non-breaking space
                        outputDiv.appendChild(commandElement);
                        outputDiv.appendChild(document.createElement('br')); // Add a line break

                        commandInput.value = ''; // Ensure it's cleared
                        outputDiv.scrollTop = outputDiv.scrollHeight; // Scroll to bottom
                        commandInput.focus(); // Keep focus on input
                    }
                }
            });

            function typeResponse(text, container, callback) {
                const responseElement = document.createElement('div');
                container.appendChild(responseElement);
                let i = 0;
                const typingSpeed = 30; // Milliseconds per character (adjust for desired speed)

                function typeChar() {
                    if (i < text.length) {
                        responseElement.textContent += text.charAt(i);
                        i++;
                        // Optional: Add a subtle flicker or effect per character here for more CRT feel
                        setTimeout(typeChar, typingSpeed);
                    } else {
                        // Typing finished
                        if (callback) {
                            callback();
                        }
                    }
                }
                typeChar(); // Start typing
            }

            function escapeHtml(unsafe) {
                return unsafe
                     .replace(/&/g, "&amp;")
                     .replace(/</g, "&lt;")
                     .replace(/>/g, "&gt;")
                     .replace(/"/g, "&quot;")
                     .replace(/'/g, "&#039;");
            }

            // Focus on input when clicking anywhere in the terminal
            document.getElementById('terminal').addEventListener('click', () => {
                commandInput.focus();
            });
        });
    </script>
</body>
</html>
